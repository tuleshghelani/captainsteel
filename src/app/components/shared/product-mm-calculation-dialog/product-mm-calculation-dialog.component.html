<div class="dialog-backdrop" (click)="close.emit()"></div>
<div class="dialog calculation-dialog">
  <div class="dialog-header">
    <h3>
      <i class="fas fa-ruler"></i>
      MM Calculation - {{ product.name }}
    </h3>
    <button class="close-button" (click)="close.emit()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="dialog-content">
    <form [formGroup]="calculationForm">
      <div class="calculation-table">
        <table>
          <thead>
            <tr>
              <th>Length (mm)</th>
              <th>Width (mm)</th>
              <th>Nos</th>
              <th>Sq. MM</th>
              <th>Sq. Feet</th>
              <th>Weight</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody formArrayName="calculations">
            <tr *ngFor="let row of calculationsArray.controls; let i = index" [formGroupName]="i">
              <td>
                <input type="number" formControlName="length" class="form-control" min="0">
              </td>
              <td>
                <input type="number" formControlName="width" class="form-control" min="0">
              </td>
              <td>
                <input type="number" formControlName="nos" class="form-control" min="1">
              </td>
              <td>
                <input type="number" formControlName="sqMM" class="form-control" readonly>
              </td>
              <td>
                <input type="number" formControlName="sqFeet" class="form-control" readonly>
              </td>
              <td>
                <input type="number" formControlName="weight" class="form-control" readonly>
              </td>
              <td>
                <button 
                  type="button" 
                  class="btn-icon delete" 
                  (click)="removeRow(i)"
                  [disabled]="calculationsArray.length === 1"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td>{{ totals.totalLength }}</td>
              <td>{{ totals.totalWidth }}</td>
              <td>{{ totals.totalNos }}</td>
              <td>{{ totals.totalSqMM }}</td>
              <td>{{ totals.totalSqFeet }}</td>
              <td>{{ totals.totalWeight }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="dialog-actions">
        <button type="button" class="btn btn-secondary" (click)="addRow()">
          <i class="fas fa-plus"></i> Add Row
        </button>
        <button type="button" class="btn btn-primary" (click)="onSave()">
          <i class="fas fa-save"></i> Save Calculation
        </button>
      </div>
    </form>
  </div>
</div> 